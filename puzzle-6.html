<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¬¸ì œ 6</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .wrap { max-width:min(860px,92vw); margin:40px auto 0; padding:16px; text-align:center; }
    .card { background:#1a1a1a; border:1px solid #2a2a2a; border-radius:16px; padding:24px; }
    .title{ font-size:1.35rem; margin:0 0 6px; }
    .desc { color:#bdbdbd; margin:0 0 12px; }
    .seq  { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#0f0f0f; border:1px solid #333; border-radius:10px; padding:10px 12px; display:inline-block; }
    .msg  { margin-top:14px; font-weight:800; min-height:1.5em; }
    .ok   { color:#7cfc9c; }
    .err  { color:#ff6b6b; }
    .muted{ color:#8a8a8a; font-size:.92rem; margin-top:10px; }
  </style>
</head>
<body>
  <main class="wrap">
    <div class="card">
      <h1 class="title">ë¬¸ì œ 6</h1>
      <p class="desc">ì •í•´ì§„ ìˆœì„œëŒ€ë¡œ ì¹´ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”. (ì˜¤ë‹µ ì‹œ ì²˜ìŒë¶€í„°)</p>
      <div class="seq">í˜„ì¬ ì§„í–‰: <span id="curSeq">â€”</span></div>
      <div id="msg" class="msg"></div>
      <div class="muted">ê°™ì€ ì¹´ë“œë¥¼ ì—°ì†ìœ¼ë¡œ ëŒ€ë©´ ë¬´ì‹œë©ë‹ˆë‹¤.</div>
    </div>
  </main>
  <script src="script.js"></script>
  <script>
          // ì•„ë˜ì™€ ê°™ì´ NFC ì¸ì½”ë”© ì§„í–‰
          // "https://your-domain.com/nfc-order.html?team=A&nfc=A&next=final-page.html&seq=A,B,C,D"
          // "https://your-domain.com/nfc-order.html?team=A&nfc=B&next=final-page.html&seq=A,B,C,D"
          // "https://your-domain.com/nfc-order.html?team=A&nfc=C&next=final-page.html&seq=A,B,C,D"
          // "https://your-domain.com/nfc-order.html?team=A&nfc=D&next=final-page.html&seq=A,B,C,D"
  (function(){
    const qs   = new URLSearchParams(location.search);
    const team = (qs.get("team") || "A").toUpperCase();
    const tag  = (qs.get("nfc") || "").toUpperCase().trim();
    const next = qs.get("next") || "final.html";
    const seqParam = (qs.get("seq") || "A,B,C,D").split(",").map(s=>s.toUpperCase().trim()).filter(Boolean);

    const LS_SEQ   = `EG_${team}_NFC_SEQ`;
    const LS_LAST  = `EG_${team}_NFC_LAST_TS`;
    const LS_LASTID= `EG_${team}_NFC_LAST_ID`;

    const GAP_LIMIT_SEC = 0; // 0 = ì œí•œ ì—†ìŒ
    const FAIL_ON_SAME_CONSECUTIVE = false; // trueë©´ ì—°ì† ë™ì¼ íƒœê·¸ëŠ” ì‹¤íŒ¨ ì²˜ë¦¬

    function go(url){
      if (window.__EG_goWithTeam) { window.__EG_goWithTeam(url); }
      else {
        const sep = url.includes("?") ? "&" : "?";
        location.href = `${url}${sep}team=${encodeURIComponent(team)}`;
      }
    }

    const curSeqEl  = document.getElementById("curSeq");
    const msgEl     = document.getElementById("msg");

    let curSeq = [];
    try { curSeq = JSON.parse(localStorage.getItem(LS_SEQ) || "[]"); if (!Array.isArray(curSeq)) curSeq = []; } catch { curSeq = []; }

    if (GAP_LIMIT_SEC > 0) {
      const lastTs = parseInt(localStorage.getItem(LS_LAST) || "0", 10);
      if (lastTs) {
        const now = Math.floor(Date.now()/1000);
        if ((now - lastTs) > GAP_LIMIT_SEC) {
          curSeq = [];
          localStorage.removeItem(LS_SEQ);
        }
      }
    }

    const lastId = localStorage.getItem(LS_LASTID) || "";
    if (tag && tag === lastId) {
      if (FAIL_ON_SAME_CONSECUTIVE) {
        msgEl.textContent = "âŒ ê°™ì€ íƒœê·¸ë¥¼ ì—°ì†ìœ¼ë¡œ ìŠ¤ìº”í–ˆìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ!";
        msgEl.className = "msg err";
        localStorage.removeItem(LS_SEQ);
        localStorage.removeItem(LS_LAST);
        localStorage.setItem(LS_LASTID, tag);
        return;
      } else {
        msgEl.textContent = "ë™ì¼ íƒœê·¸ ì—°ì† ìŠ¤ìº”ì€ ë¬´ì‹œë©ë‹ˆë‹¤. ë‹¤ìŒ íƒœê·¸ë¡œ ì§„í–‰í•˜ì„¸ìš”.";
        msgEl.className = "msg";
        curSeqEl.textContent = curSeq.length ? curSeq.join(" â†’ ") : "â€”";
        localStorage.setItem(LS_LAST, Math.floor(Date.now()/1000));
        return;
      }
    }

    if (tag) {
      const expected = seqParam[curSeq.length];
      if (tag !== expected) {
        msgEl.textContent = `âŒ ìˆœì„œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤! ì²˜ìŒë¶€í„° ë‹¤ì‹œ.`;
        msgEl.className = "msg err";
        localStorage.removeItem(LS_SEQ);
        localStorage.setItem(LS_LASTID, tag);
        localStorage.setItem(LS_LAST, Math.floor(Date.now()/1000));
        curSeq = [];
      } else {
        curSeq.push(tag);
        localStorage.setItem(LS_SEQ, JSON.stringify(curSeq));
        localStorage.setItem(LS_LASTID, tag);
        localStorage.setItem(LS_LAST, Math.floor(Date.now()/1000));

        if (curSeq.length < seqParam.length) {
          msgEl.textContent = `âœ” ì˜¬ë°”ë¦…ë‹ˆë‹¤! (${curSeq.length}/${seqParam.length}) ê³„ì† ì§„í–‰.`;
          msgEl.className = "msg ok";
        } else {
          msgEl.textContent = "ğŸ‰ ì„±ê³µ! ì´ë™í•©ë‹ˆë‹¤â€¦";
          msgEl.className = "msg ok";
          localStorage.removeItem(LS_SEQ);
          setTimeout(()=> go(next), 900);
        }
      }
    } else {
      msgEl.textContent = "ì´ í˜ì´ì§€ëŠ” NFC íƒœê·¸ë¥¼ í†µí•´ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤.";
    }

    curSeqEl.textContent = curSeq.length ? curSeq.join(" â†’ ") : "â€”";
  })();
  </script>
  
  <script>
  // === ì„¤ì • ===
  const HINT_DELAY_SEC = 1060; // 18ë¶„
  const COMMON_HINT_TEXT =
    "ê°™ì€ ìƒ‰ê¹”ë¼ë¦¬ ë¬¶ì–´ì„œ í•œê³³ìœ¼ë¡œ ëª¨ì•„ë³´ì‹œë©´ ìˆ«ìê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ê·¸ê²ƒì„ ì‘ì€ ìˆœì„œëŒ€ë¡œ ë°°ì¹˜í•˜ë©´ ìƒ‰ê¹” ìˆœì„œê°€ ë‚˜ì˜¤ê³  í•´ë‹¹ ìƒ‰ê¹” ìˆœì„œë¡œ ë¬¼ì²´ë¥¼ ê°–ë‹¤ ëŒ€ì‹œë©´ ë©ë‹ˆë‹¤.";

  // íŒíŠ¸ UI ë§Œë“¤ê¸° (ì²˜ìŒì—” ìˆ¨ê¹€)
  const hintBox = document.createElement("div");
  hintBox.className = "card";
  hintBox.style.display = "none";
  hintBox.id = "autoHint";
  hintBox.innerHTML =
    `<strong>íŒíŠ¸</strong><div id="autoHintBody" class="small" style="margin-top:8px;"></div>`;
  // íŒ€ ì„¹ì…˜ì´ ìˆìœ¼ë©´ ê·¸ ì•ˆì—, ì—†ìœ¼ë©´ ë³¸ë¬¸ ëì— ë¶€ì°©
  (document.querySelector(".teamQ[style*='block']") || document.querySelector(".main"))
    .appendChild(hintBox);

  function revealHint() {
    document.getElementById("autoHintBody").textContent = COMMON_HINT_TEXT;
    hintBox.style.display = "";
  }

  (function scheduleHintByGlobalTimer(){
    const qs   = new URLSearchParams(location.search);
    const team = (qs.get("team") || "A").toUpperCase(); // í‚¤ ì ‘ë‘ì— í•„ìš”
    const START_KEY = `EG_${team}_TIMER_START_MS`;      // ì „ì—­ íƒ€ì´ë¨¸ ì‹œì‘ì‹œê°(ms)

    const startMs = parseInt(localStorage.getItem(START_KEY) || "0", 10);
    if (startMs) {
      const elapsed = Math.floor((Date.now() - startMs) / 1000);
      if (elapsed >= HINT_DELAY_SEC) {
        revealHint();              // ì´ë¯¸ 5ë¶„ ì§€ë‚¬ë‹¤ë©´ ì¦‰ì‹œ
      } else {
        setTimeout(revealHint, (HINT_DELAY_SEC - elapsed) * 1000);
      }
    } else {
      // ì•ˆì „ì¥ì¹˜: ì „ì—­ íƒ€ì´ë¨¸ê°€ ì•„ì§ ì—†ìœ¼ë©´ í˜ì´ì§€ ë¡œë“œ ê¸°ì¤€ìœ¼ë¡œ ë”œë ˆì´
      setTimeout(revealHint, HINT_DELAY_SEC * 1000);
    }

    // ìš´ì˜/í…ŒìŠ¤íŠ¸ìš©: ì¦‰ì‹œ í‘œì‹œ ìŠ¤ìœ„ì¹˜ (?revealHint=1)
    if (qs.get("revealHint") === "1") revealHint();
  })();
</script>
</body>
</html>